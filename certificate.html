<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SuDo | E-Certificate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background: #111;
    margin: 0;
    font-family: "Georgia", serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 20px 0;
  }

  .cert {
    position: relative;
    background: #fff;
    width: 210mm;
    height: 297mm;
    margin: auto;
    padding: 40mm 30mm;
    border: 10px solid #000;
    box-sizing: border-box;
    text-align: center;
    overflow: hidden;
  }

  .cert::before {
    content: "";
    position: absolute;
    inset: 0;
    background: url("./images/cover1.jpg") center/cover no-repeat;
    opacity: 0.12;
    z-index: 0;
  }

  .cert * {
    position: relative;
    z-index: 1;
  }

  h1 { font-size: 42px; letter-spacing: 2px; }
  .subtitle { font-size: 16px; letter-spacing: 3px; margin-bottom: 30px; text-transform: uppercase; }
  .name { font-size: 36px; font-weight: bold; margin: 25px 0; text-transform: uppercase; }
  .statement { font-size: 18px; line-height: 1.6; margin: 15px 0; }
  .details { margin-top: 25px; font-size: 17px; }
  .footer { margin-top: 40px; font-size: 14px; color: #444; }

  @media (max-width: 768px) {
    .cert { width: 100%; height: auto; padding: 30px 20px; }
    h1 { font-size: 28px; }
    .name { font-size: 24px; }
    .statement { font-size: 15px; }
  }

  @media print {
    @page { size: A4; margin: 0; }
    body { background: #fff; padding: 0; }
    .cert-btn { display: none !important; }
    * {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
  }
</style>
</head>

<body>

<div class="cert">

  <h1>Certificate of Achievement</h1>
  <div class="subtitle">Endurance ‚Ä¢ Grit ‚Ä¢ Victory</div>

  <p class="statement">This certificate is proudly awarded to</p>

  <div class="name" id="name">LOADING‚Ä¶</div>

  <p class="statement">
    for demonstrating unwavering determination, relentless endurance,
    and the courage to push beyond limits by successfully conquering
    the <strong><span id="raceTitle"></span></strong>.
  </p>

  <p class="statement">
    This achievement stands as proof that strength is earned,
    limits are broken, and finish lines are claimed.
  </p>

  <div class="details">
    <strong>Bib Number:</strong> <span id="bib"></span><br>
    <strong>Finish Time:</strong> <span id="time"></span><br>
    <strong>Overall Rank:</strong> <span id="rank"></span>
  </div>

  <div class="footer">
    Issued by <strong>Yodgab Bansalan and Su.Do Athletics</strong>
  </div>

  <br>
  <button class="btn btn-success mt-3 cert-btn" onclick="downloadPNG()">
    Download Certificate (PNG)
  </button>

  <br><br>

  <button class="btn btn-dark cert-btn" onclick="window.print()">
    Print Certificate
  </button>

  <br><br>
  <a href="index.html" class="text-decoration-none cert-btn">‚Üê Back to Results</a>

</div>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const params = new URLSearchParams(window.location.search);
const bib = params.get("bib");

/* üî• OPTION B: LOAD BOTH JSON FILES */
Promise.all([
  fetch("./12kmres.json").then(r => r.json()),
  fetch("./25kmres.json").then(r => r.json())
]).then(([res12, res25]) => {

  const allResults = [...res12, ...res25];

  const runner = allResults.find(x => x["Bib Number"] === bib);
  if (!runner) {
    document.body.innerHTML =
      "<h2 style='color:white;text-align:center'>Runner not found</h2>";
    return;
  }

  document.getElementById("name").innerText =
    runner["Runner Name"] || "UNKNOWN FINISHER";

  document.getElementById("bib").innerText =
    runner["Bib Number"];

  document.getElementById("time").innerText =
    runner["Lap Time"];

  document.getElementById("rank").innerText =
    runner.rank;

  document.getElementById("raceTitle").innerText =
    runner.category == 25
      ? "25-Kilometer Trail Challenge"
      : "12-Kilometer Trail Run Race";
});

/* PNG DOWNLOAD */
function downloadPNG() {
  const cert = document.querySelector(".cert");
  const buttons = cert.querySelectorAll(".cert-btn");

  buttons.forEach(btn => btn.style.display = "none");

  html2canvas(cert, {
    scale: 2,
    useCORS: true,
    backgroundColor: null
  }).then(canvas => {
    const link = document.createElement("a");

    const name = document.getElementById("name").innerText
      .replace(/[^a-z0-9]/gi, "_")
      .toLowerCase();

    const bibVal = document.getElementById("bib").innerText || "certificate";

    link.download = `${bibVal}_${name}.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();

    buttons.forEach(btn => btn.style.display = "");
  });
}
</script>

</body>
</html>


